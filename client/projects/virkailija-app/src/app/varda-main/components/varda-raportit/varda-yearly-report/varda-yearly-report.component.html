<div class="full-width-row">
  <div class="modal-form-intro col-12">
    {{ i18n.yearly_report_instructions | translate }}
  </div>
</div>
<div *ngIf="!yearlyReport" class="full-width-row yearly-report-form">
  <div class="col-md-6 col-lg-4">
    <label for="organizationInput"
           class="oph-bold">{{i18n.vakajarjestaja | translate}}</label>
    <app-varda-autocomplete-selector [options]="organizationOptions"
                                     id="organizationInput"
                                     name="organizationInput"
                                     #organizationSelector
                                     [optionFormat]="{format: '{0}', properties:['nimi']}"
                                     [nullValue]="null"
                                     [disabled]="!isOPHUser"
                                     [placeholder]="i18n.yearly_report_all_organizations | translate"
                                     [nullOptionLabel]="i18n.yearly_report_all_organizations | translate"
                                     [invalidInputLabel]="i18n.yearly_report_error_no_organization_selected | translate"
                                     [(ngModel)]="selectedVakajarjestaja">
    </app-varda-autocomplete-selector>
  </div>
  <div class="col-md-4 col-lg-3 margin-top-md">
    <label for="yearSelect"
           class="oph-bold">{{i18n.yearly_report_tilastovuosi | translate}}</label>
    <div class="oph-select-container">
      <select class="oph-input oph-select"
              name="yearSelect"
              id="yearSelect"
              [(ngModel)]="newYearlyReport.tilastovuosi">
        <option *ngFor="let year of yearOptions" [ngValue]="year">{{year}}</option>
      </select>
    </div>
  </div>
  <div class="col-md-6 col-lg-4 margin-top-lg">
    <label for="datePicker"
           class="oph-bold">{{i18n.yearly_report_poiminta_pvm | translate}}</label>
    <app-varda-datepicker #datePicker="ngModel"
                          name="datePicker"
                          id="datePicker"
                          [(ngModel)]="poimintaPvm"
                          [required]="false"
                          [max]="today">
    </app-varda-datepicker>
    <div aria-live="assertive"
         class="varda-error-message-block"
         role="alert"
         *ngIf="datePicker.invalid">
      <p>{{i18n.katsele_tietoja_error_date_format | translate}}</p>
    </div>
  </div>
  <div class="col-12 margin-top">
    <button class="varda-button varda-icon-button"
            type="button"
            (click)="postYearlyReport()"
            [disabled]="isLoading">
      <mat-icon alt="">add</mat-icon>
      {{i18n.yearly_report_create | translate}}
    </button>
  </div>
  <div class="col-12 margin-top">
    <app-varda-error-field [errors]="errors"></app-varda-error-field>
  </div>
</div>
<div *ngIf="yearlyReport" class="full-width-row">
  <div class="col-12 yearly-report-form">
    <button class="varda-button varda-button-neutral varda-icon-button"
            type="button"
            (click)="cancel()">
      <mat-icon alt="">keyboard_backspace</mat-icon>
      {{i18n.cancel | translate}}
    </button>
  </div>
  <div class="col-12 margin-top">
    <h2 class="oph-h2">
      {{(newYearlyReport.vakajarjestaja_input === 'all' ? (i18n.yearly_report_all_organizations | translate) : selectedVakajarjestaja.nimi)}},
      {{i18n.yearly_report_tilastovuosi | translate | lowercase}}: {{newYearlyReport.tilastovuosi}},
      {{i18n.yearly_report_poiminta_pvm | translate | lowercase}}: {{getUiDateTime(yearlyReport.poiminta_pvm)}}
    </h2>
    <h2 class="oph-h2"
        *ngIf="yearlyReport.status === ReportStatus.PENDING || yearlyReport.status === ReportStatus.CREATING">
      <span class="badge badge-secondary">
        {{i18n.status | translate}}: {{getReportStatusTranslationKey(yearlyReport.status) | translate | lowercase}}
      </span>
    </h2>
  </div>
  <div class="col-12 margin-top"
       *ngIf="yearlyReport.status === ReportStatus.PENDING || yearlyReport.status === ReportStatus.CREATING">
    <mat-progress-bar mode="indeterminate" class="varda-theme"></mat-progress-bar>
  </div>
  <div class="col-12 col-md-10 col-lg-8 col-xl-7 margin-top" *ngIf="yearlyReport.status === ReportStatus.FINISHED">
    <div *ngFor="let data of [[datasourceAll, i18n.yearly_report_all], [datasourceOwn, i18n.yearly_report_own], [datasourcePaos, i18n.yearly_report_paos]]"
         class="margin-top-large">
      <span class="oph-bold margin-top">{{data[1] | translate}}</span>
      <div class="table-responsive">
        <table mat-table [dataSource]="data[0]">
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>{{i18n.katsele_tietoja_yhteenveto_key | translate }}</th>
            <td mat-cell *matCellDef="let element">{{element.name | translate}}</td>
          </ng-container>
          <ng-container matColumnDef="value">
            <th mat-header-cell *matHeaderCellDef>{{i18n.katsele_tietoja_yhteenveto_value | translate }}</th>
            <td mat-cell *matCellDef="let element">
              {{element.value === true || element.value === false ? ((element.value ? i18n.yes : i18n.no) | translate) : (element.value | number:undefined:'fi')}}
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </div>
    </div>
  </div>
</div>
