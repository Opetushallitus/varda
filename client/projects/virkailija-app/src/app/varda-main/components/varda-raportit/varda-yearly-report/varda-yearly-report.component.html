<div class="full-width-row">
  <div class="modal-form-intro col-12">
    {{ i18n.yearly_report_instructions | translate }}
  </div>
</div>
<div *ngIf="!yearlyReport" class="full-width-row yearly-report-form">
  <div class="col-md-6 col-lg-4">
    <label for="organizationInput"
           class="oph-bold">{{i18n.vakajarjestaja | translate}}</label>
    <app-varda-autocomplete-selector [options]="organizationOptions"
                                     id="organizationInput"
                                     name="organizationInput"
                                     #organizationSelector
                                     [optionFormat]="{format: '{0}', properties:['nimi']}"
                                     [nullValue]="null"
                                     [disabled]="!isOPHUser"
                                     [placeholder]="i18n.yearly_report_all_organizations | translate"
                                     [nullOptionLabel]="i18n.yearly_report_all_organizations | translate"
                                     [invalidInputLabel]="i18n.yearly_report_error_no_organization_selected | translate"
                                     [(ngModel)]="selectedVakajarjestaja">
    </app-varda-autocomplete-selector>
  </div>
  <div class="col-md-4 col-lg-3 margin-top-md">
    <label for="yearSelect"
           class="oph-bold">{{i18n.yearly_report_tilastovuosi | translate}}</label>
    <div class="oph-select-container">
      <select class="oph-input oph-select"
              name="yearSelect"
              id="yearSelect"
              [(ngModel)]="newYearlyReport.tilastovuosi">
        <option *ngFor="let year of yearOptions" [ngValue]="year">{{year}}</option>
      </select>
    </div>
  </div>
  <div class="col-md-6 col-lg-4 margin-top-lg">
    <label for="datePicker"
           class="oph-bold">{{i18n.yearly_report_poiminta_pvm | translate}}</label>
    <app-varda-datepicker #datePicker="ngModel"
                          name="datePicker"
                          id="datePicker"
                          [(ngModel)]="poimintaPvm"
                          [required]="false"
                          [max]="today">
    </app-varda-datepicker>
    <div aria-live="assertive"
         class="varda-error-message-block"
         role="alert"
         *ngIf="datePicker.invalid">
      <p>{{i18n.katsele_tietoja_error_date_format | translate}}</p>
    </div>
  </div>
  <div class="col-12 margin-top">
    <button class="varda-button varda-icon-button"
            type="button"
            (click)="postYearlyReport()"
            [disabled]="isLoading">
      <mat-icon alt="">add</mat-icon>
      {{i18n.yearly_report_create | translate}}
    </button>
  </div>
  <div class="col-12 margin-top">
    <app-varda-error-field [errors]="errors"></app-varda-error-field>
  </div>
</div>
<div *ngIf="yearlyReport" class="full-width-row">
  <div class="col-12 yearly-report-form">
    <button class="varda-button varda-button-neutral varda-icon-button"
            type="button"
            (click)="cancel()">
      <mat-icon alt="">keyboard_backspace</mat-icon>
      {{i18n.cancel | translate}}
    </button>
  </div>
  <div class="col-12 margin-top">
    <h2 class="oph-h2">
      {{(newYearlyReport.vakajarjestaja_input === 'all' ? (i18n.yearly_report_all_organizations | translate) : selectedVakajarjestaja.nimi)}},
      {{i18n.yearly_report_tilastovuosi | translate | lowercase}}: {{newYearlyReport.tilastovuosi}},
      {{i18n.yearly_report_poiminta_pvm | translate | lowercase}}: {{getUiDateTime(yearlyReport.poiminta_pvm)}}
    </h2>
    <h2 class="oph-h2"
        *ngIf="yearlyReport.status === ReportStatus.PENDING || yearlyReport.status === ReportStatus.CREATING">
      <span class="badge badge-secondary">
        {{i18n.status | translate}}: {{getReportStatusTranslationKey(yearlyReport.status) | translate | lowercase}}
      </span>
    </h2>
  </div>
  <div class="col-12 margin-top"
       *ngIf="yearlyReport.status === ReportStatus.PENDING || yearlyReport.status === ReportStatus.CREATING">
    <mat-progress-bar mode="indeterminate" class="varda-theme"></mat-progress-bar>
  </div>
  <div class="col-12 col-md-10 col-lg-8 col-xl-7 margin-top" *ngIf="yearlyReport.status === ReportStatus.FINISHED">
    <app-mat-table-dummy></app-mat-table-dummy>
    <div class="margin-top-large">
      <span class="oph-bold margin-top">{{i18n.yearly_report_all | translate}}</span>
      <div class="table-responsive">
        <table class="mat-table">
          <tr class="mat-header-row">
            <th class="mat-header-cell">{{i18n.katsele_tietoja_yhteenveto_key | translate}}</th>
            <th class="mat-header-cell">{{i18n.katsele_tietoja_yhteenveto_value | translate}}</th>
          </tr>
          <tr class="mat-row">
            <td class="mat-cell">{{i18n.yearly_report_result_vakajarjestaja_count | translate}}</td>
            <td class="mat-cell">{{yearlyReport.vakajarjestaja_count | number:undefined:'fi'}}</td>
          </tr>
          <tr class="mat-row">
            <td class="mat-cell">{{i18n.yearly_report_result_vakajarjestaja_is_active | translate}}</td>
            <td class="mat-cell">{{(yearlyReport.vakajarjestaja_is_active ? i18n.yes : i18n.no) | translate}}</td>
          </tr>
          <tr class="mat-row">
            <td class="mat-cell">{{i18n.yearly_report_result_toimipaikka_count | translate}}</td>
            <td class="mat-cell">{{yearlyReport.toimipaikka_count | number:undefined:'fi'}}</td>
          </tr>
          <tr class="mat-row">
            <td class="mat-cell table-subheader" colspan="2">
              {{ i18n.yearly_report_result_toimipaikka_by_toimintamuoto_count | translate }}
            </td>
          </tr>
          <tr *ngFor="let toimintamuoto of getEntries(yearlyReport.toimipaikka_by_toimintamuoto_count)"
              class="mat-row table-subrow">
            <td class="mat-cell" [libKoodistoValue]="KoodistoEnum.toimintamuoto" format="long">{{toimintamuoto[0]}}</td>
            <td class="mat-cell">{{toimintamuoto[1] | number:undefined:'fi'}}</td>
          </tr>
          <tr class="mat-row">
            <td class="mat-cell">{{i18n.yearly_report_result_varhaiskasvatuspaikat_sum | translate}}</td>
            <td class="mat-cell">{{yearlyReport.varhaiskasvatuspaikat_sum | number:undefined:'fi'}}</td>
          </tr>
          <tr class="mat-row">
            <td class="mat-cell">{{i18n.yearly_report_result_toimintapainotus_count | translate}}</td>
            <td class="mat-cell">{{yearlyReport.toimintapainotus_count | number:undefined:'fi'}}</td>
          </tr>
          <tr class="mat-row">
            <td class="mat-cell">{{i18n.yearly_report_result_kielipainotus_count | translate}}</td>
            <td class="mat-cell">{{yearlyReport.kielipainotus_count | number:undefined:'fi'}}</td>
          </tr>
          <tr class="mat-row">
            <td class="mat-cell">{{i18n.yearly_report_result_yhteensa_henkilo_count | translate}}</td>
            <td class="mat-cell">{{yearlyReport.yhteensa_henkilo_count | number:undefined:'fi'}}</td>
          </tr>
          <tr class="mat-row">
            <td class="mat-cell">{{i18n.yearly_report_result_yhteensa_lapsi_count | translate}}</td>
            <td class="mat-cell">{{yearlyReport.yhteensa_lapsi_count | number:undefined:'fi'}}</td>
          </tr>
          <tr class="mat-row">
            <td class="mat-cell">{{i18n.yearly_report_result_yhteensa_varhaiskasvatussuhde_count | translate}}</td>
            <td class="mat-cell">{{yearlyReport.yhteensa_varhaiskasvatussuhde_count | number:undefined:'fi'}}</td>
          </tr>
          <tr class="mat-row">
            <td class="mat-cell">{{i18n.yearly_report_result_yhteensa_varhaiskasvatuspaatos_count | translate}}</td>
            <td class="mat-cell">{{yearlyReport.yhteensa_varhaiskasvatuspaatos_count | number:undefined:'fi'}}</td>
          </tr>
          <tr class="mat-row">
            <td class="mat-cell">{{i18n.yearly_report_result_yhteensa_vuorohoito_count | translate}}</td>
            <td class="mat-cell">{{yearlyReport.yhteensa_vuorohoito_count | number:undefined:'fi'}}</td>
          </tr>
          <tr class="mat-row">
            <td class="mat-cell">{{i18n.yearly_report_result_yhteensa_maksutieto_count | translate}}</td>
            <td class="mat-cell">{{yearlyReport.yhteensa_maksutieto_count | number:undefined:'fi'}}</td>
          </tr>
          <tr class="mat-row">
            <td class="mat-cell table-subheader" colspan="2">
              {{ i18n.maksutieto_maksunperuste_koodi | translate }}
            </td>
          </tr>
          <tr class="mat-row table-subrow">
            <td class="mat-cell" [libKoodistoValue]="KoodistoEnum.maksunperuste" format="long">mp01</td>
            <td class="mat-cell">{{yearlyReport.yhteensa_maksutieto_mp01_count | number:undefined:'fi'}}</td>
          </tr>
          <tr class="mat-row table-subrow">
            <td class="mat-cell" [libKoodistoValue]="KoodistoEnum.maksunperuste" format="long">mp02</td>
            <td class="mat-cell">{{yearlyReport.yhteensa_maksutieto_mp02_count | number:undefined:'fi'}}</td>
          </tr>
          <tr class="mat-row table-subrow">
            <td class="mat-cell" [libKoodistoValue]="KoodistoEnum.maksunperuste" format="long">mp03</td>
            <td class="mat-cell">{{yearlyReport.yhteensa_maksutieto_mp03_count | number:undefined:'fi'}}</td>
          </tr>
        </table>
      </div>
    </div>

    <div class="margin-top-large">
      <span class="oph-bold margin-top">{{i18n.yearly_report_own | translate}}</span>
      <div class="table-responsive">
        <table class="mat-table">
          <tr class="mat-header-row">
            <th class="mat-header-cell">{{i18n.katsele_tietoja_yhteenveto_key | translate}}</th>
            <th class="mat-header-cell">{{i18n.katsele_tietoja_yhteenveto_value | translate}}</th>
          </tr>
          <tr class="mat-row">
            <td class="mat-cell">{{i18n.yearly_report_result_oma_henkilo_count | translate}}</td>
            <td class="mat-cell">{{yearlyReport.oma_henkilo_count | number:undefined:'fi'}}</td>
          </tr>
          <tr class="mat-row">
            <td class="mat-cell">{{i18n.yearly_report_result_oma_lapsi_count | translate}}</td>
            <td class="mat-cell">{{yearlyReport.oma_lapsi_count | number:undefined:'fi'}}</td>
          </tr>
          <tr class="mat-row">
            <td class="mat-cell">{{i18n.yearly_report_result_oma_varhaiskasvatussuhde_count | translate}}</td>
            <td class="mat-cell">{{yearlyReport.oma_varhaiskasvatussuhde_count | number:undefined:'fi'}}</td>
          </tr>
          <tr class="mat-row">
            <td class="mat-cell">{{i18n.yearly_report_result_oma_varhaiskasvatuspaatos_count | translate}}</td>
            <td class="mat-cell">{{yearlyReport.oma_varhaiskasvatuspaatos_count | number:undefined:'fi'}}</td>
          </tr>
          <tr class="mat-row">
            <td class="mat-cell">{{i18n.yearly_report_result_oma_vuorohoito_count | translate}}</td>
            <td class="mat-cell">{{yearlyReport.oma_vuorohoito_count | number:undefined:'fi'}}</td>
          </tr>
          <tr class="mat-row">
            <td class="mat-cell">{{i18n.yearly_report_result_oma_maksutieto_count | translate}}</td>
            <td class="mat-cell">{{yearlyReport.oma_maksutieto_count | number:undefined:'fi'}}</td>
          </tr>
          <tr class="mat-row">
            <td class="mat-cell table-subheader" colspan="2">
              {{ i18n.maksutieto_maksunperuste_koodi | translate }}
            </td>
          </tr>
          <tr class="mat-row table-subrow">
            <td class="mat-cell" [libKoodistoValue]="KoodistoEnum.maksunperuste" format="long">mp01</td>
            <td class="mat-cell">{{yearlyReport.oma_maksutieto_mp01_count | number:undefined:'fi'}}</td>
          </tr>
          <tr class="mat-row table-subrow">
            <td class="mat-cell" [libKoodistoValue]="KoodistoEnum.maksunperuste" format="long">mp02</td>
            <td class="mat-cell">{{yearlyReport.oma_maksutieto_mp02_count | number:undefined:'fi'}}</td>
          </tr>
          <tr class="mat-row table-subrow">
            <td class="mat-cell" [libKoodistoValue]="KoodistoEnum.maksunperuste" format="long">mp03</td>
            <td class="mat-cell">{{yearlyReport.oma_maksutieto_mp03_count | number:undefined:'fi'}}</td>
          </tr>
        </table>
      </div>
    </div>

    <div class="margin-top-large">
      <span class="oph-bold margin-top">{{i18n.yearly_report_paos | translate}}</span>
      <div class="table-responsive">
        <table class="mat-table">
          <tr class="mat-header-row">
            <th class="mat-header-cell">{{i18n.katsele_tietoja_yhteenveto_key | translate}}</th>
            <th class="mat-header-cell">{{i18n.katsele_tietoja_yhteenveto_value | translate}}</th>
          </tr>
          <tr class="mat-row">
            <td class="mat-cell">{{i18n.yearly_report_result_paos_henkilo_count | translate}}</td>
            <td class="mat-cell">{{yearlyReport.paos_henkilo_count | number:undefined:'fi'}}</td>
          </tr>
          <tr class="mat-row">
            <td class="mat-cell">{{i18n.yearly_report_result_paos_lapsi_count | translate}}</td>
            <td class="mat-cell">{{yearlyReport.paos_lapsi_count | number:undefined:'fi'}}</td>
          </tr>
          <tr class="mat-row">
            <td class="mat-cell">{{i18n.yearly_report_result_paos_varhaiskasvatussuhde_count | translate}}</td>
            <td class="mat-cell">{{yearlyReport.paos_varhaiskasvatussuhde_count | number:undefined:'fi'}}</td>
          </tr>
          <tr class="mat-row">
            <td class="mat-cell">{{i18n.yearly_report_result_paos_varhaiskasvatuspaatos_count | translate}}</td>
            <td class="mat-cell">{{yearlyReport.paos_varhaiskasvatuspaatos_count | number:undefined:'fi'}}</td>
          </tr>
          <tr class="mat-row">
            <td class="mat-cell">{{i18n.yearly_report_result_paos_vuorohoito_count | translate}}</td>
            <td class="mat-cell">{{yearlyReport.paos_vuorohoito_count | number:undefined:'fi'}}</td>
          </tr>
          <tr class="mat-row">
            <td class="mat-cell">{{i18n.yearly_report_result_paos_maksutieto_count | translate}}</td>
            <td class="mat-cell">{{yearlyReport.paos_maksutieto_count | number:undefined:'fi'}}</td>
          </tr>
          <tr class="mat-row">
            <td class="mat-cell table-subheader" colspan="2">
              {{ i18n.maksutieto_maksunperuste_koodi | translate }}
            </td>
          </tr>
          <tr class="mat-row table-subrow">
            <td class="mat-cell" [libKoodistoValue]="KoodistoEnum.maksunperuste" format="long">mp01</td>
            <td class="mat-cell">{{yearlyReport.paos_maksutieto_mp01_count | number:undefined:'fi'}}</td>
          </tr>
          <tr class="mat-row table-subrow">
            <td class="mat-cell" [libKoodistoValue]="KoodistoEnum.maksunperuste" format="long">mp02</td>
            <td class="mat-cell">{{yearlyReport.paos_maksutieto_mp02_count | number:undefined:'fi'}}</td>
          </tr>
          <tr class="mat-row table-subrow">
            <td class="mat-cell" [libKoodistoValue]="KoodistoEnum.maksunperuste" format="long">mp03</td>
            <td class="mat-cell">{{yearlyReport.paos_maksutieto_mp03_count | number:undefined:'fi'}}</td>
          </tr>
        </table>
      </div>
    </div>
  </div>
</div>
